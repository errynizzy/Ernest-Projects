<title>Get POS Transaction 2</title><?php
echo('<meta http-equiv="refresh" content="150">');
ini_set('max_execution_time', 900000);
//at the end this script should refresh every 15 minutes
$dbstr ="(DESCRIPTION =(ADDRESS = (PROTOCOL = TCP)(HOST =10.10.10.7)(PORT = 1521))(CONNECT_DATA = (SERVER = DEDICATED)(SERVICE_NAME = cc)))";

//oracle
$conn = oci_connect('cc','smart',$dbstr);
$t = date("Y-m-d H:i:s");
$d = date('m/d/Y');
$msg = '<style type="text/css">
<!--
.style1 {
	font-family: Arial, Helvetica, sans-serif;
	font-weight: bold;
}
-->
</style>
<div align="center">
  <p class="style1">Get POS Transaction History Query 2 Completed Successfully</p>
  <p class="style1">Last Query Run: </p>
';
$msgl = '</div>';


//mysql in my laptop
mysql_connect("localhost","root","mahad");
mysql_select_db("connekt");




//fetch from oracle
$sql = "SELECT a.acct_book_id,
			to_char(a.created_date,'mm/dd/yyyy') TRANSFER_DATE,
             h.cust_name ORIGIANL_CUSTOMER,
             g.acc_nbr ORG_SERVICE_NUMBER,
             -1*a.charge / 100 charge,
             e.cust_name DESTINATION_CUSTOMER,
             b.acc_nbr DEST_SERVICE_NUMBER
       FROM acct_book    A,
            subs         B,
            bal_transfer C,
            cust         E,
            acct_book    F,
            subs         G,
            cust         H
       Where -- trunc(a.created_date) >= trunc(sysdate-8)
       -- and   trunc(a.created_date) <= trunc(sysdate-2)
        a.acct_id = b.acct_id
       and b.cust_id = e.cust_id
       and a.acct_book_type in ('L')
       and a.acct_book_id = c.in_acct_book_id
       and c.acct_book_id = f.acct_book_id
       and f.acct_id = g.acct_id
       and g.cust_id = h.cust_id
       and to_char(a.created_date,'mm/dd/yyyy') between '$d' and '$d'
       and g.acc_nbr in (

'798099050',
'798099005',
'798099046',
'798099161',
'798099098',
'798099017',
'798099147',
'798099057',
'798099649',
'798099356',
'798099173',
'798099152',
'798099038',
'798099139',
'798099035',
'798099044',
'798099182',
'798099171',
'798099003',
'798099011',
'798099246',
'798099224',
'798099159',
'798099074',
'798098977',
'798099158',
'798099458',
'798099816',
'798098904',
'798099053',
'798098924',
'798099178',
'798099602',
'798099487',
'798099369',
'798099180',
'798099374',
'798099181',
'798099485',
'798099013',
'798099573',
'798099464',
'798098930',
'798099067',
'798099179',
'798099185',
'798099103',
'798099177',
'798099101',
'798099138',
'798099510',
'798099484',
'798099600',
'798099481',
'798099086',
'798099363',
'798099272',
'798099100',
'798098986',
'798091067',
'798091052',
'798091059',
'798091057',
'798091042',
'798091061',
'798091065',
'798091047',
'798091055',
'798091043',
'798091048',
'798091066',
'798091045',
'798091063',
'798091060',
'798091044',
'798091054',
'798091050',
'798091056',
'798091039',
'798091053',
'798091051',
'798091046',
'798091062',
'798091058',
'798091033',
'798091041',
'798091064',
'798099124',
'798095135',
'798091027',
'798091025',
'798098950',
'798091022',
'798091021',
'798091020',
'798091089',
'798091019',
'798099992',
'798091024',
'798099995',
'798099994',
'798091023',
'798099993',
'798098925',
'798091037',
'798091312',
'798091311',
'798099253',
'798099352',
'798099367',
'798099340',
'798099349',
'798099383',
'798099328',
'798099288',
'798099362',
'798099292',
'798091303',
'798099387',
'798099348',
'798099220',
'798099205',
'798091294',
'798091302',
'798091297',
'798091296',
'798091299',
'798091298',
'798091295',
'798091293',
'798091367',
'798091362',
'798091307',
'798091364',
'798091365',
'798091366',
'798091376',
'798091373',
'798091369',
'798091377',
'798091374',
'798091375',
'798091371',
'798091363',
'798091370',
'798091368',
'798091372',
'798091306',
'798091304',
'798091380',
'798091382',
'798091384',
'798091381',
'798091383',
'798091391',
'798091300',
'798091310',
'798091301',
'798091308',
'798091309',
'798091359',
'798091379',
'798091305',
'798091378',
'798091341',
'798091322',
'798091324',
'798091358',
'798091323',
'798091344',
'798091343',
'798091346',
'798091315',
'798091351',
'798091325',
'798091340',
'798091350',
'798091349',
'798091357',
'798091321',
'798091328',
'798091338',
'798449939',
'798091334',
'798091335',
'798091330',
'798091336',
'798091337',
'798091333',
'798091326',
'798091354',
'798091348',
'798091342',
'798091339',
'798091353',
'798091352',
'798091356',
'798091329',
'798091332',
'798091320',
'798091981',
'798091982',
'798097432',
'798097484',
'798097438',
'798091360',
'798099290',
'798094946',
'798099226',
'798096829',
'798097430',
'798097445',
'798097437',
'798097486',
'798097777',
'798092061',
'798097434',
'798096739',
'798097428',
'798093704',
'798097441',
'798097427',
'798097444',
'798097443',
'798097435',
'798097433',
'798097487',
'798297439',
'798097400',
'798096636',
'798097399',
'798097436',
'798096788',
'798096601',
'798097440',
'798097429',
'798096988',
'798092271',
'798094945',
'798097104',
'798092917',
'798097442',
'798095849',
'798097482',
'798097483',
'798093430',
'798091385',
'798091388',
'798091387',
'798091386',
'798095665',
'798097442',
'798097482',
'798092917',
'798093430',
'798095849',
'798097483',
'798095667',
'798095666',
'798095668',
'798095664',
'798095663',
'798095662',
'798095254',
'798094990',
'798093866',
'798095422',
'798091037',
'798097453',
'798091042',
'798091048',
'798091051',
'798091052',
'798091054',
'798091055',
'798091057',
'798091060',
'798091061',
'798091067',
'798091303',
'798091311',
'798091389',
'798091390',
'798091392',
'798092333',
'798095135',
'798096601',
'798096988',
'798097104',
'798097434',
'798097437',
'798097443',
'798097459',
'798098928',
'798098930',
'798099038',
'798099042',
'798099044',
'798099054',
'798099101',
'798099103',
'798099139',
'798099149',
'798099156',
'798099171',
'798099174',
'798099182',
'798099185',
'798099251',
'798099258',
'798099369',
'798099380',
'798099383',
'798099391',
'798099441',
'798099467',
'798099468',
'798099472',
'798099481',
'798099510',
'798099587',
'798099600',
'798099608',
'798099992',
'798091019',
'798091041',
'798091045',
'798091050',
'798091064',
'798093704',
'798097400',
'798097484',
'798097777',
'798098929',
'798098932',
'798099013',
'798099020',
'798099079',
'798099150',
'798099169',
'798099181',
'798099184',
'798099295',
'798099443',
'798099486',
'798099604',
'798091020',
'798091053',
'798096945',
'798097399',
'798097427',
'798097428',
'798097441',
'798098998',
'798099016',
'798099017',
'798099023',
'798099041',
'798099060',
'798099097',
'798099098',
'798099109',
'798099112',
'798099130',
'798099189',
'798099231',
'798099270',
'798099446',
'798099473',
'798096739',
'798097430',
'798097519',
'798098957',
'798098996',
'798099018',
'798099046',
'798099048',
'798099075',
'798099137',
'798099160',
'798099172',
'798099175',
'798099176',
'798099277',
'798099575',
'798099993',
'798097444',
'798098934',
'798099015',
'798099177',
'798099272',
'798099040',
'798098983',
'798099008',
'798099211',
'798099601',
'798098910',
'798099358',
'798099477',
'798099045',
'798099585',
'798099062',
'798099435',
'798099166',
'798099201',
'798099296',
'798099218',
'798099111',
'798099055',
'798099077',
'798098903',
'798099170',
'798099068',
'798098900',
'798099090',
'798099229',
'798099221',
'798099379',
'798098948',
'798098982',
'798098981',
'798098971',
'798098962',
'798099186',
'798099121',
'798099028',
'798099030',
'798098985',
'798099619',
'798099012',
'798099000',
'798099047',
'798099154',
'798099073',
'798099533',
'798099489',
'798099455',
'798099360',
'798099072',
'798099247',
'798098997',
'798098961',
'798099535',
'798099461',
'798099536',
'798099162',
'798099153',
'798099155',
'798099102',
'798099049',
'798099444',
'798099268',
'798099009',
'798099145',
'798099319',
'798099243',
'798099275',
'798099228',
'798099355',
'798099212',
'798099357',
'798099660',
'798099745',
'798099236',
'798099338',
'798099043',
'798098959',
'798099110',
'798099088',
'798099126',
'798099058',
'798099291',
'798099370',
'798099006',
'798099193',
'798099284',
'798099004',
'798099092',
'798099131',
'798099021',
'798099024',
'798099163',
'798099002',
'798099482',
'798099449',
'798099261',
'798099167',
'798099025',
'798099308',
'798099239',
'798099301',
'798099252',
'798098965',
'798099127',
'798098908',
'798099168',
'798099320',
'798098918',
'798099447',
'798099522',
'798098953',
'798098956',
'798099036',
'798099438',
'798099339',
'798098978',
'798099010',
'798099052',
'798099143',
'798098895',
'798099164',
'798099142',
'798098944',
'798099148',
'798099022',
'798099269',
'798098909',
'798098970',
'798099037',
'798098960',
'798099297',
'798099007',
'798099039',
'798099183',
'798099001',
'798098933',
'798099050',
'798099005',
'798099161',
'798099569',
'798099147',
'798099057',
'798099649',
'798099356',
'798099173',
'798099152',
'798099035',
'798099003',
'798099011',
'798099246',
'798099224',
'798099159',
'798099074',
'798098977',
'798099158',
'798099458',
'798099816',
'798098904',
'798099053',
'798098924',
'798099178',
'798099602',
'798099487',
'798099453',
'798099180',
'798099374',
'798099485',
'798099573',
'798099464',
'798099067',
'798099179',
'798099138',
'798099484',
'798099086',
'798099363',
'798091082',
'798091081',
'798091080',
'798091068',
'798091069',
'798091070',
'798091072',
'798091071',
'798091079',
'798091078',
'798091077',
'798091073',
'798091074',
'798091086',
'798091075',
'798091076',
'798091088',
'798091087',
'798091084',
'798091085',
'798099100',
'798098986',
'798091059',
'798091065',
'798091047',
'798091043',
'798091066',
'798091063',
'798091021',
'798091022',
'798091023',
'798091024',
'798091025',
'798091027',
'798091033',
'798091039',
'798091044',
'798091046',
'798091056',
'798091058',
'798091062',
'798091089',
'798091293',
'798091294',
'798091295',
'798091296',
'798091297',
'798091298',
'798091299',
'798091300',
'798091301',
'798091302',
'798091304',
'798091305',
'798091306',
'798091307',
'798091308',
'798091309',
'798091310',
'798091312',
'798091315',
'798091322',
'798091323',
'798091324',
'798091325',
'798091328',
'798091340',
'798091341',
'798091343',
'798091344',
'798091346',
'798091349',
'798091350',
'798091351',
'798091357',
'798091358',
'798091359',
'798091362',
'798091363',
'798091364',
'798091365',
'798091366',
'798091367',
'798091368',
'798091369',
'798091370',
'798091371',
'798091372',
'798091373',
'798091374',
'798091375',
'798091376',
'798091377',
'798091378',
'798091379',
'798091380',
'798091381',
'798091382',
'798091383',
'798091384',
'798091391',
'798098925',
'798098950',
'798098987',
'798099124',
'798099205',
'798099220',
'798099253',
'798099288',
'798099292',
'798099328',
'798099340',
'798099348',
'798099349',
'798099352',
'798099362',
'798099367',
'798099387',
'798099994',
'798099995',
'798097432',
'798097438',
'798091360',
'798099290',
'798094946',
'798099226',
'798096829',
'798097445',
'798097486',
'798092061',
'798097435',
'798097433',
'798097487',
'798297439',
'798096636',
'798097436',
'798096788',
'798097440',
'798097429',
'798092271',
'798094945',
'798097162',
'798091361',
'798091385',
'798091388',
'798091387',
'798091386'

     )
       order by 1,2 asc";

$stmt = oci_parse($conn, $sql);

oci_execute($stmt);

echo '<pre>';

while ( $row = oci_fetch_assoc($stmt) ) {
  print_r($row); // just to dispaly in browser to confirm if it works


	$ACCT_BOOK_ID = $row['ACCT_BOOK_ID'];
 $TRANSFER_DATE = $row['TRANSFER_DATE'];
 $ORIGIANL_CUSTOMER = $row['ORIGIANL_CUSTOMER'];
 $ORG_SERVICE_NUMBER = $row['ORG_SERVICE_NUMBER'];
 $CHARGE = $row['CHARGE'];
 $DESTINATION_CUSTOMER = $row['DESTINATION_CUSTOMER'];
 $DEST_SERVICE_NUMBER = $row['DEST_SERVICE_NUMBER'];
  
  //insert to my sql table 
  $sql = ("INSERT INTO history (ACCT_BOOK_ID,TRANSFER_DATE, ORIGIANL_CUSTOMER, ORG_SERVICE_NUMBER, CHARGE, DESTINATION_CUSTOMER, DEST_SERVICE_NUMBER)

VALUES
(
'".$ACCT_BOOK_ID."',

'".$TRANSFER_DATE."',

'".$ORIGIANL_CUSTOMER."',

'".$ORG_SERVICE_NUMBER."',

'".$CHARGE."',

'".$DESTINATION_CUSTOMER."',

'".$DEST_SERVICE_NUMBER."'


)");

mysql_query($sql);


}
echo $msg. " ".$t.$msgl;
?>